import json

import unittest

from mathlearning.mappers.solution_tree_mapper import SolutionTreeMapper
from mathlearning.model.derivative_theorems import DerivativeTheorems
from mathlearning.model.expression import Expression
from mathlearning.model.theorem import Theorem
from mathlearning.services.result_service import ResultService
from test.testutils.solved_exercises import SolvedExercises

tree_byte_arr = b'"{\\"expression\\": \\"Derivative(x*exp(x), x) + Derivative(x**2*sin(x), x)\\", \\"theorem_applied\\": {\\"name\\": \\"none\\"}, \\"branches\\": [{\\"expression\\": \\"x**2*Derivative(sin(x), x) + sin(x)*Derivative(x**2, x) + Derivative(x*exp(x), x)\\", \\"theorem_applied\\": {\\"name\\": \\"derivada del producto\\", \\"right\\": \\"f{\\\\\\\\left(x \\\\\\\\right)} \\\\\\\\frac{d(g{\\\\\\\\left(x \\\\\\\\right)})}{dx} + g{\\\\\\\\left(x \\\\\\\\right)} \\\\\\\\frac{d(f{\\\\\\\\left(x \\\\\\\\right)})}{dx}\\", \\"left\\": \\"\\\\\\\\frac{d(f{\\\\\\\\left(x \\\\\\\\right)} g{\\\\\\\\left(x \\\\\\\\right)})}{dx}\\"}, \\"branches\\": [{\\"expression\\": \\"x**2*Derivative(sin(x), x) + x*Derivative(exp(x), x) + exp(x)*Derivative(x, x) + sin(x)*Derivative(x**2, x)\\", \\"theorem_applied\\": {\\"name\\": \\"derivada del producto\\", \\"right\\": \\"f{\\\\\\\\left(x \\\\\\\\right)} \\\\\\\\frac{d(g{\\\\\\\\left(x \\\\\\\\right)})}{dx} + g{\\\\\\\\left(x \\\\\\\\right)} \\\\\\\\frac{d(f{\\\\\\\\left(x \\\\\\\\right)})}{dx}\\", \\"left\\": \\"\\\\\\\\frac{d(f{\\\\\\\\left(x \\\\\\\\right)} g{\\\\\\\\left(x \\\\\\\\right)})}{dx}\\"}, \\"branches\\": [{\\"expression\\": \\"x**2*Derivative(sin(x), x) + x*exp(x) + exp(x)*Derivative(x, x) + sin(x)*Derivative(x**2, x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": [{\\"expression\\": \\"x**2*cos(x) + x*exp(x) + exp(x)*Derivative(x, x) + sin(x)*Derivative(x**2, x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": [{\\"expression\\": \\"x**2*cos(x) + x*exp(x) + exp(x) + sin(x)*Derivative(x**2, x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": [{\\"expression\\": \\"x**2*cos(x) + x*exp(x) + 2*x*sin(x) + exp(x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": []}]}, {\\"expression\\": \\"x**2*cos(x) + x*exp(x) + 2*x*sin(x) + exp(x)*Derivative(x, x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": [{\\"expression\\": \\"x**2*cos(x) + x*exp(x) + 2*x*sin(x) + exp(x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": []}]}]}, {\\"expression\\": \\"x**2*Derivative(sin(x), x) + x*exp(x) + exp(x) + sin(x)*Derivative(x**2, x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": [{\\"expression\\": \\"x**2*cos(x) + x*exp(x) + exp(x) + sin(x)*Derivative(x**2, x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": []}, {\\"expression\\": \\"x**2*Derivative(sin(x), x) + x*exp(x) + 2*x*sin(x) + exp(x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": [{\\"expression\\": \\"x**2*cos(x) + x*exp(x) + 2*x*sin(x) + exp(x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": []}]}]}, {\\"expression\\": \\"x**2*Derivative(sin(x), x) + x*exp(x) + 2*x*sin(x) + exp(x)*Derivative(x, x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": [{\\"expression\\": \\"x**2*cos(x) + x*exp(x) + 2*x*sin(x) + exp(x)*Derivative(x, x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": []}, {\\"expression\\": \\"x**2*Derivative(sin(x), x) + x*exp(x) + 2*x*sin(x) + exp(x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": []}]}]}, {\\"expression\\": \\"x**2*cos(x) + x*Derivative(exp(x), x) + exp(x)*Derivative(x, x) + sin(x)*Derivative(x**2, x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": [{\\"expression\\": \\"x**2*cos(x) + x*exp(x) + exp(x)*Derivative(x, x) + sin(x)*Derivative(x**2, x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": []}, {\\"expression\\": \\"x**2*cos(x) + x*Derivative(exp(x), x) + exp(x) + sin(x)*Derivative(x**2, x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": [{\\"expression\\": \\"x**2*cos(x) + x*exp(x) + exp(x) + sin(x)*Derivative(x**2, x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": []}, {\\"expression\\": \\"x**2*cos(x) + 2*x*sin(x) + x*Derivative(exp(x), x) + exp(x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": [{\\"expression\\": \\"x**2*cos(x) + x*exp(x) + 2*x*sin(x) + exp(x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": []}]}]}, {\\"expression\\": \\"x**2*cos(x) + 2*x*sin(x) + x*Derivative(exp(x), x) + exp(x)*Derivative(x, x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": [{\\"expression\\": \\"x**2*cos(x) + x*exp(x) + 2*x*sin(x) + exp(x)*Derivative(x, x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": []}, {\\"expression\\": \\"x**2*cos(x) + 2*x*sin(x) + x*Derivative(exp(x), x) + exp(x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": []}]}]}, {\\"expression\\": \\"x**2*Derivative(sin(x), x) + x*Derivative(exp(x), x) + exp(x) + sin(x)*Derivative(x**2, x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": [{\\"expression\\": \\"x**2*Derivative(sin(x), x) + x*exp(x) + exp(x) + sin(x)*Derivative(x**2, x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": []}, {\\"expression\\": \\"x**2*cos(x) + x*Derivative(exp(x), x) + exp(x) + sin(x)*Derivative(x**2, x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": []}, {\\"expression\\": \\"x**2*Derivative(sin(x), x) + 2*x*sin(x) + x*Derivative(exp(x), x) + exp(x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": [{\\"expression\\": \\"x**2*Derivative(sin(x), x) + x*exp(x) + 2*x*sin(x) + exp(x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": []}, {\\"expression\\": \\"x**2*cos(x) + 2*x*sin(x) + x*Derivative(exp(x), x) + exp(x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": []}]}]}, {\\"expression\\": \\"x**2*Derivative(sin(x), x) + 2*x*sin(x) + x*Derivative(exp(x), x) + exp(x)*Derivative(x, x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": [{\\"expression\\": \\"x**2*Derivative(sin(x), x) + x*exp(x) + 2*x*sin(x) + exp(x)*Derivative(x, x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": []}, {\\"expression\\": \\"x**2*cos(x) + 2*x*sin(x) + x*Derivative(exp(x), x) + exp(x)*Derivative(x, x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": []}, {\\"expression\\": \\"x**2*Derivative(sin(x), x) + 2*x*sin(x) + x*Derivative(exp(x), x) + exp(x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": []}]}]}, {\\"expression\\": \\"x**2*cos(x) + sin(x)*Derivative(x**2, x) + Derivative(x*exp(x), x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": [{\\"expression\\": \\"x**2*cos(x) + x*Derivative(exp(x), x) + exp(x)*Derivative(x, x) + sin(x)*Derivative(x**2, x)\\", \\"theorem_applied\\": {\\"name\\": \\"derivada del producto\\", \\"right\\": \\"f{\\\\\\\\left(x \\\\\\\\right)} \\\\\\\\frac{d(g{\\\\\\\\left(x \\\\\\\\right)})}{dx} + g{\\\\\\\\left(x \\\\\\\\right)} \\\\\\\\frac{d(f{\\\\\\\\left(x \\\\\\\\right)})}{dx}\\", \\"left\\": \\"\\\\\\\\frac{d(f{\\\\\\\\left(x \\\\\\\\right)} g{\\\\\\\\left(x \\\\\\\\right)})}{dx}\\"}, \\"branches\\": []}, {\\"expression\\": \\"x**2*cos(x) + 2*x*sin(x) + Derivative(x*exp(x), x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": [{\\"expression\\": \\"x**2*cos(x) + 2*x*sin(x) + x*Derivative(exp(x), x) + exp(x)*Derivative(x, x)\\", \\"theorem_applied\\": {\\"name\\": \\"derivada del producto\\", \\"right\\": \\"f{\\\\\\\\left(x \\\\\\\\right)} \\\\\\\\frac{d(g{\\\\\\\\left(x \\\\\\\\right)})}{dx} + g{\\\\\\\\left(x \\\\\\\\right)} \\\\\\\\frac{d(f{\\\\\\\\left(x \\\\\\\\right)})}{dx}\\", \\"left\\": \\"\\\\\\\\frac{d(f{\\\\\\\\left(x \\\\\\\\right)} g{\\\\\\\\left(x \\\\\\\\right)})}{dx}\\"}, \\"branches\\": []}, {\\"expression\\": \\"x**2*cos(x) + 2*x*sin(x) + (x + 1)*exp(x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": []}]}, {\\"expression\\": \\"x**2*cos(x) + (x + 1)*exp(x) + sin(x)*Derivative(x**2, x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": [{\\"expression\\": \\"x**2*cos(x) + 2*x*sin(x) + (x + 1)*exp(x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": []}]}]}, {\\"expression\\": \\"x**2*Derivative(sin(x), x) + 2*x*sin(x) + Derivative(x*exp(x), x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": [{\\"expression\\": \\"x**2*Derivative(sin(x), x) + 2*x*sin(x) + x*Derivative(exp(x), x) + exp(x)*Derivative(x, x)\\", \\"theorem_applied\\": {\\"name\\": \\"derivada del producto\\", \\"right\\": \\"f{\\\\\\\\left(x \\\\\\\\right)} \\\\\\\\frac{d(g{\\\\\\\\left(x \\\\\\\\right)})}{dx} + g{\\\\\\\\left(x \\\\\\\\right)} \\\\\\\\frac{d(f{\\\\\\\\left(x \\\\\\\\right)})}{dx}\\", \\"left\\": \\"\\\\\\\\frac{d(f{\\\\\\\\left(x \\\\\\\\right)} g{\\\\\\\\left(x \\\\\\\\right)})}{dx}\\"}, \\"branches\\": []}, {\\"expression\\": \\"x**2*cos(x) + 2*x*sin(x) + Derivative(x*exp(x), x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": []}, {\\"expression\\": \\"x**2*Derivative(sin(x), x) + 2*x*sin(x) + (x + 1)*exp(x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": [{\\"expression\\": \\"x**2*cos(x) + 2*x*sin(x) + (x + 1)*exp(x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": []}]}]}, {\\"expression\\": \\"x**2*Derivative(sin(x), x) + (x + 1)*exp(x) + sin(x)*Derivative(x**2, x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": [{\\"expression\\": \\"x**2*cos(x) + (x + 1)*exp(x) + sin(x)*Derivative(x**2, x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": []}, {\\"expression\\": \\"x**2*Derivative(sin(x), x) + 2*x*sin(x) + (x + 1)*exp(x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": []}]}]}, {\\"expression\\": \\"x*Derivative(exp(x), x) + exp(x)*Derivative(x, x) + Derivative(x**2*sin(x), x)\\", \\"theorem_applied\\": {\\"name\\": \\"derivada del producto\\", \\"right\\": \\"f{\\\\\\\\left(x \\\\\\\\right)} \\\\\\\\frac{d(g{\\\\\\\\left(x \\\\\\\\right)})}{dx} + g{\\\\\\\\left(x \\\\\\\\right)} \\\\\\\\frac{d(f{\\\\\\\\left(x \\\\\\\\right)})}{dx}\\", \\"left\\": \\"\\\\\\\\frac{d(f{\\\\\\\\left(x \\\\\\\\right)} g{\\\\\\\\left(x \\\\\\\\right)})}{dx}\\"}, \\"branches\\": [{\\"expression\\": \\"x**2*Derivative(sin(x), x) + x*Derivative(exp(x), x) + exp(x)*Derivative(x, x) + sin(x)*Derivative(x**2, x)\\", \\"theorem_applied\\": {\\"name\\": \\"derivada del producto\\", \\"right\\": \\"f{\\\\\\\\left(x \\\\\\\\right)} \\\\\\\\frac{d(g{\\\\\\\\left(x \\\\\\\\right)})}{dx} + g{\\\\\\\\left(x \\\\\\\\right)} \\\\\\\\frac{d(f{\\\\\\\\left(x \\\\\\\\right)})}{dx}\\", \\"left\\": \\"\\\\\\\\frac{d(f{\\\\\\\\left(x \\\\\\\\right)} g{\\\\\\\\left(x \\\\\\\\right)})}{dx}\\"}, \\"branches\\": []}, {\\"expression\\": \\"x*exp(x) + exp(x)*Derivative(x, x) + Derivative(x**2*sin(x), x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": [{\\"expression\\": \\"x**2*Derivative(sin(x), x) + x*exp(x) + exp(x)*Derivative(x, x) + sin(x)*Derivative(x**2, x)\\", \\"theorem_applied\\": {\\"name\\": \\"derivada del producto\\", \\"right\\": \\"f{\\\\\\\\left(x \\\\\\\\right)} \\\\\\\\frac{d(g{\\\\\\\\left(x \\\\\\\\right)})}{dx} + g{\\\\\\\\left(x \\\\\\\\right)} \\\\\\\\frac{d(f{\\\\\\\\left(x \\\\\\\\right)})}{dx}\\", \\"left\\": \\"\\\\\\\\frac{d(f{\\\\\\\\left(x \\\\\\\\right)} g{\\\\\\\\left(x \\\\\\\\right)})}{dx}\\"}, \\"branches\\": []}, {\\"expression\\": \\"x*exp(x) + exp(x) + Derivative(x**2*sin(x), x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": [{\\"expression\\": \\"x**2*Derivative(sin(x), x) + x*exp(x) + exp(x) + sin(x)*Derivative(x**2, x)\\", \\"theorem_applied\\": {\\"name\\": \\"derivada del producto\\", \\"right\\": \\"f{\\\\\\\\left(x \\\\\\\\right)} \\\\\\\\frac{d(g{\\\\\\\\left(x \\\\\\\\right)})}{dx} + g{\\\\\\\\left(x \\\\\\\\right)} \\\\\\\\frac{d(f{\\\\\\\\left(x \\\\\\\\right)})}{dx}\\", \\"left\\": \\"\\\\\\\\frac{d(f{\\\\\\\\left(x \\\\\\\\right)} g{\\\\\\\\left(x \\\\\\\\right)})}{dx}\\"}, \\"branches\\": []}, {\\"expression\\": \\"x*(x*cos(x) + 2*sin(x)) + x*exp(x) + exp(x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": []}]}, {\\"expression\\": \\"x*(x*cos(x) + 2*sin(x)) + x*exp(x) + exp(x)*Derivative(x, x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": [{\\"expression\\": \\"x*(x*cos(x) + 2*sin(x)) + x*exp(x) + exp(x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": []}]}]}, {\\"expression\\": \\"x*Derivative(exp(x), x) + exp(x) + Derivative(x**2*sin(x), x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": [{\\"expression\\": \\"x**2*Derivative(sin(x), x) + x*Derivative(exp(x), x) + exp(x) + sin(x)*Derivative(x**2, x)\\", \\"theorem_applied\\": {\\"name\\": \\"derivada del producto\\", \\"right\\": \\"f{\\\\\\\\left(x \\\\\\\\right)} \\\\\\\\frac{d(g{\\\\\\\\left(x \\\\\\\\right)})}{dx} + g{\\\\\\\\left(x \\\\\\\\right)} \\\\\\\\frac{d(f{\\\\\\\\left(x \\\\\\\\right)})}{dx}\\", \\"left\\": \\"\\\\\\\\frac{d(f{\\\\\\\\left(x \\\\\\\\right)} g{\\\\\\\\left(x \\\\\\\\right)})}{dx}\\"}, \\"branches\\": []}, {\\"expression\\": \\"x*exp(x) + exp(x) + Derivative(x**2*sin(x), x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": []}, {\\"expression\\": \\"x*(x*cos(x) + 2*sin(x)) + x*Derivative(exp(x), x) + exp(x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": [{\\"expression\\": \\"x*(x*cos(x) + 2*sin(x)) + x*exp(x) + exp(x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": []}]}]}, {\\"expression\\": \\"x*(x*cos(x) + 2*sin(x)) + x*Derivative(exp(x), x) + exp(x)*Derivative(x, x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": [{\\"expression\\": \\"x*(x*cos(x) + 2*sin(x)) + x*exp(x) + exp(x)*Derivative(x, x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": []}, {\\"expression\\": \\"x*(x*cos(x) + 2*sin(x)) + x*Derivative(exp(x), x) + exp(x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": []}]}]}, {\\"expression\\": \\"(x + 1)*exp(x) + Derivative(x**2*sin(x), x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": [{\\"expression\\": \\"x**2*Derivative(sin(x), x) + (x + 1)*exp(x) + sin(x)*Derivative(x**2, x)\\", \\"theorem_applied\\": {\\"name\\": \\"derivada del producto\\", \\"right\\": \\"f{\\\\\\\\left(x \\\\\\\\right)} \\\\\\\\frac{d(g{\\\\\\\\left(x \\\\\\\\right)})}{dx} + g{\\\\\\\\left(x \\\\\\\\right)} \\\\\\\\frac{d(f{\\\\\\\\left(x \\\\\\\\right)})}{dx}\\", \\"left\\": \\"\\\\\\\\frac{d(f{\\\\\\\\left(x \\\\\\\\right)} g{\\\\\\\\left(x \\\\\\\\right)})}{dx}\\"}, \\"branches\\": []}, {\\"expression\\": \\"x*(x*cos(x) + 2*sin(x)) + (x + 1)*exp(x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": []}]}, {\\"expression\\": \\"x*(x*cos(x) + 2*sin(x)) + Derivative(x*exp(x), x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": [{\\"expression\\": \\"x*(x*cos(x) + 2*sin(x)) + x*Derivative(exp(x), x) + exp(x)*Derivative(x, x)\\", \\"theorem_applied\\": {\\"name\\": \\"derivada del producto\\", \\"right\\": \\"f{\\\\\\\\left(x \\\\\\\\right)} \\\\\\\\frac{d(g{\\\\\\\\left(x \\\\\\\\right)})}{dx} + g{\\\\\\\\left(x \\\\\\\\right)} \\\\\\\\frac{d(f{\\\\\\\\left(x \\\\\\\\right)})}{dx}\\", \\"left\\": \\"\\\\\\\\frac{d(f{\\\\\\\\left(x \\\\\\\\right)} g{\\\\\\\\left(x \\\\\\\\right)})}{dx}\\"}, \\"branches\\": []}, {\\"expression\\": \\"x*(x*cos(x) + 2*sin(x)) + (x + 1)*exp(x)\\", \\"theorem_applied\\": {\\"name\\": \\"resolver derivadas\\", \\"right\\": \\"\\\\\\\\text{NaN}\\", \\"left\\": \\"\\\\\\\\text{NaN}\\"}, \\"branches\\": []}]}]}"'
exercise = SolvedExercises.derivative_e_plus_sin()
tree = SolutionTreeMapper.parse(json.loads(tree_byte_arr))
theorems = DerivativeTheorems.get_all()

resultService = ResultService()

class TestResultService(unittest.TestCase):

    def test_resolve_invalid_steps_at_the_same_point_should_return_the_same_hints(self):
        wrong_step = Expression("x")
        step_list=list(map(lambda ex: Expression(ex, is_latex=False), exercise.steps_non_latex[0:2]))
        result, hints = resultService.resolve(
            problem_input=Expression(exercise.steps_non_latex[0], is_latex=False),
            solution_tree=tree,
            exercise_type='derivative',
            step_list=step_list,
            current_expression=wrong_step,
            theorems=theorems
        )
        print(result, hints)
        self.assertTrue(DerivativeTheorems.derivative_of_a_multiplication() in hints)
        self.assertTrue(Theorem('resolver derivadas', None, None, []) in hints)

